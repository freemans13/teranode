
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../blockAssembly/">
      
      
        <link rel="next" href="../blockchain/">
      
      
        
      
      
      <link rel="icon" href="../../architecture/img/bsvblockchain_blue_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Block Validation - Teranode</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../overrides/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#block-validation-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Teranode" class="md-header__button md-logo" aria-label="Teranode" data-md-component="logo">
      
  <img src="../../architecture/img/bsvblockchain_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teranode
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Block Validation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tutorials/developers/forkAndPullRequestGuidelines/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../howto/locallyRunningServices/" class="md-tabs__link">
          
  
  
  How-To Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../teranodeIntro/" class="md-tabs__link">
          
  
  
  Key Topics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../references/projectStructure/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Teranode" class="md-nav__button md-logo" aria-label="Teranode" data-md-component="logo">
      
  <img src="../../architecture/img/bsvblockchain_logo.svg" alt="logo">

    </a>
    Teranode
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/developers/forkAndPullRequestGuidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fork and Pull Request Guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/developers/developerSetup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/miners/minersGettingStarted/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Miners Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    How-To Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    How-To Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/locallyRunningServices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Services Locally
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/howToRemoteDebugTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging Teranode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/generatingProtobuf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Generating Protobuf
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/addingNewProtobufServices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adding Protobuf
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/configuringGrpcLogging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuring gRPC Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/runningTests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/automatedTestingHowTo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Automated Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/chain-integrity-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chain Integrity Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/makefile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Makefile Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/bugReporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bug Reporting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/developersHowToTeranodeCLI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer's Guide to Teranode-CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12" >
        
          
          <label class="md-nav__link" for="__nav_3_12" id="__nav_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Miners
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Miners
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_1" >
        
          
          <label class="md-nav__link" for="__nav_3_12_1" id="__nav_3_12_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToInstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToInstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToInstallationDeprecated/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deprecated
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_2" >
        
          
          <label class="md-nav__link" for="__nav_3_12_2" id="__nav_3_12_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToConfigureTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToConfigureTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToAerospikeTuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aerospike Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToInteractWithAssetServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Asset Server Interaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToInteractWithFSM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FSM Interaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToInteractWithRPCServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RPC Server Interaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_3" >
        
          
          <label class="md-nav__link" for="__nav_3_12_3" id="__nav_3_12_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Start/Stop
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Start/Stop
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToStopStartDockerTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToStopStartKubernetesTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_4" >
        
          
          <label class="md-nav__link" for="__nav_3_12_4" id="__nav_3_12_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Updating Teranode
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Updating Teranode
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersUpdatingTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersUpdatingTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_5" >
        
          
          <label class="md-nav__link" for="__nav_3_12_5" id="__nav_3_12_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security Best Practices
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security Best Practices
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersSecurityBestPractices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersSecurityBestPractices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_6" >
        
          
          <label class="md-nav__link" for="__nav_3_12_6" id="__nav_3_12_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Troubleshooting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToTroubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToTroubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_7" >
        
          
          <label class="md-nav__link" for="__nav_3_12_7" id="__nav_3_12_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reset Teranode
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reset Teranode
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToResetTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToResetTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_8" >
        
          
          <label class="md-nav__link" for="__nav_3_12_8" id="__nav_3_12_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sync the Node
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sync the Node
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToSyncTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToSyncTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_9" >
        
          
          <label class="md-nav__link" for="__nav_3_12_9" id="__nav_3_12_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Additional
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Additional
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToBackup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup Teranode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToCPUMiner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CPU Mining Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToTeranodeCLI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Teranode CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersManagingDiskSpace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Managing Disk Space
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToUseListenMode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Listen Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Key Topics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Key Topics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../teranodeIntro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Teranode Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/teranode-overall-system-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/teranode-architecture-brief/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Brief
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/teranode-microservices-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microservices Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transactionLifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transaction Lifecycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/stateManagement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../state-machine.diagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State Machine Diagram
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/understandingDoubleSpends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding Double Spends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technologyStack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Technology Stack
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../understandingTheTestingFramework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding the Testing Framework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functionalRequirementTests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Functional Requirement Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_12" >
        
          
          <label class="md-nav__link" for="__nav_4_12" id="__nav_4_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/two_phase_commit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Two Phase Commit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/peer_registry_reputation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Peer Registry and Reputation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/utxo_lock_records/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Lock Records
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_14" checked>
        
          
          <label class="md-nav__link" for="__nav_4_14" id="__nav_4_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_14_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alert Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assetServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Asset Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockAssembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Assembly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Block Validation
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Validation
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      
        Index
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Description
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detailed-component-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detailed Component Diagram
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Functionality
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-receiving-blocks-for-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1. Receiving blocks for validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-validating-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2. Validating blocks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2. Validating blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.1. Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.1. Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimistic-mining-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimistic Mining Mode
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-catching-up-after-a-parent-block-is-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.2. Catching up after a parent block is not found
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.2. Catching up after a parent block is not found">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catchup-process-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Catchup Process Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fsm-state-transitions-during-catchup" class="md-nav__link">
    <span class="md-ellipsis">
      
        FSM State Transitions During Catchup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#header-chain-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Header Chain Cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpoint-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checkpoint Verification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer-quality-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Peer Quality Tracking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-and-peer-quality" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling and Peer Quality
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-fetch-sequential-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concurrent Fetch + Sequential Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-quick-validation-for-checkpointed-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.3. Quick Validation for Checkpointed Blocks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.3. Quick Validation for Checkpointed Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-validation-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Validation Process
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpoint-based-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checkpoint-Based Optimization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Benefits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtree-and-transaction-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Subtree and Transaction Processing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-validating-the-subtrees" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.4. Validating the Subtrees
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225-block-data-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.5. Block Data Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-transaction-re-presentation-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.6. Transaction Re-presentation Detection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.6. Transaction Re-presentation Detection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bloom-filter-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bloom Filter Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-validorderandblessed-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        The validOrderAndBlessed Mechanism
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-fork-management-and-chain-reorganization" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.7. Fork Management and Chain Reorganization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.7. Fork Management and Chain Reorganization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fork-states-and-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork States and Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork-registration-and-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork Registration and Tracking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-fork-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallel Fork Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork Resolution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork Cleanup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-block-priority-queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Block Priority Queue
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-block-processing-queue-and-priority-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.8. Block Processing Queue and Priority System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.8. Block Processing Queue and Priority System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#priority-levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        Priority Levels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queue-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Queue Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-source-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternative Source Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coordination-with-fork-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coordination with Fork Manager
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229-malicious-peer-detection-and-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.9. Malicious Peer Detection and Tracking
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.9. Malicious Peer Detection and Tracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detection-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detection Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer-quality-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Peer Quality Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer-banning-future-feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Peer Banning (Future Feature)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210-invalid-block-tracking-and-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.10. Invalid Block Tracking and Notifications
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.10. Invalid Block Tracking and Notifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-block-classification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Invalid Block Classification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-notification-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kafka Notification System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block-revalidation-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Block Revalidation Process
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-block-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Block Invalidation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2211-subtree-deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.11. Subtree Deduplication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.11. Subtree Deduplication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-subtree-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Subtree Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-marking-txs-as-mined" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3. Marking Txs as mined
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3. Marking Txs as mined">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trigger-points-and-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trigger Points and Sequence
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-two-phase-commit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Two-Phase Commit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsibility-and-exclusivity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Responsibility and Exclusivity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Optimization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-grpc-protobuf-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. gRPC Protobuf Definitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-data-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Data Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-technology" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Technology
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-directory-structure-and-main-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Directory Structure and Main Files
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-how-to-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. How to run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-configuration-options-settings-flags" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Configuration options (settings flags)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-other-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Other Resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blockchain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../propagation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Propagation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../subtreeValidation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subtree Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_15" >
        
          
          <label class="md-nav__link" for="__nav_4_15" id="__nav_4_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Overlay Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overlay Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockPersister/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Persister
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../p2p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    P2P
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../P2P_NAT_TRAVERSAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    P2P NAT Traversal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Legacy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rpc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utxoPersister/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Persister
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_16" >
        
          
          <label class="md-nav__link" for="__nav_4_16" id="__nav_4_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Stores
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stores/blob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blob Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stores/utxo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_17" >
        
          
          <label class="md-nav__link" for="__nav_4_17" id="__nav_4_17_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Data Model
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data Model
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodel/block_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Data Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodel/block_header_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Header Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodel/subtree_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subtree Data Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodel/transaction_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transaction Data Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodel/utxo_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Data Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_18" >
        
          
          <label class="md-nav__link" for="__nav_4_18" id="__nav_4_18_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Kafka
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kafka
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kafka Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_19" >
        
          
          <label class="md-nav__link" for="__nav_4_19" id="__nav_4_19_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/seeder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Seeder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/projectStructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API & Protobuf
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API & Protobuf
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/errorHandling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/codingConventions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coding Conventions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/kafkaMessageFormat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kafka Message Format
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/networkConsensusRules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Consensus Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_6" >
        
          
          <label class="md-nav__link" for="__nav_5_2_6" id="__nav_5_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Protobuf API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Protobuf API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/protobuf_docs/alertProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alert Proto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/protobuf_docs/blockassemblyProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Assembly Proto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/protobuf_docs/blockchainProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blockchain Proto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/protobuf_docs/blockvalidationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Validation Proto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/protobuf_docs/propagationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Propagation Proto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/protobuf_docs/subtreevalidationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subtree Validation Proto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/protobuf_docs/validatorProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validator Proto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/alert_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alert Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/asset_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Asset Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/blockassembly_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Assembly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/blockvalidation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/blockchain_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blockchain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/propagation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Propagation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/subtreevalidation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subtree Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/validator_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Overlay Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overlay Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/blockpersister_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Persister
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/p2p_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    P2P
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/legacy_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    P2P Legacy Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/rpc_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/services/utxopersister_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Persister
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stores
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/stores/blob_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blob Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/stores/utxo_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Settings Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Settings Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/global_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Global Settings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/policy_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Settings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/kafka_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kafka Settings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6_6" id="__nav_5_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Service Settings
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Service Settings
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/alert_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/asset_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Asset Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/blockassembly_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Assembly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/blockchain_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blockchain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/blockpersister_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Persister
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/blockvalidation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Block Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/legacy_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Legacy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/p2p_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    P2P
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/propagation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Propagation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/rpc_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/subtreevalidation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subtree Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/utxopersister_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Persister
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/services/validator_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_7" >
        
          
          <label class="md-nav__link" for="__nav_5_6_7" id="__nav_5_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Store Settings
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Store Settings
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/stores/aerospike_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aerospike Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/stores/blob_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blob Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/settings/stores/utxo_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UTXO Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Miscellaneous
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Miscellaneous
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/BIP-239/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BIP-239 (Transaction Extended Format)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/gitCommitSigningSetupGuide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git Commit Signing Setup Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/licenseInformation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Licensing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/prometheusMetrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prometheus Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/teranodeDaemonReference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Teranode Daemon Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/testingTechnicalReference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Technical Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/thirdPartySoftwareRequirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Third-Party Software Requirements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      
        Index
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Description
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detailed-component-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detailed Component Diagram
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Functionality
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-receiving-blocks-for-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1. Receiving blocks for validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-validating-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2. Validating blocks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2. Validating blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.1. Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.1. Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimistic-mining-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimistic Mining Mode
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-catching-up-after-a-parent-block-is-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.2. Catching up after a parent block is not found
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.2. Catching up after a parent block is not found">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catchup-process-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Catchup Process Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fsm-state-transitions-during-catchup" class="md-nav__link">
    <span class="md-ellipsis">
      
        FSM State Transitions During Catchup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#header-chain-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Header Chain Cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpoint-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checkpoint Verification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer-quality-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Peer Quality Tracking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-and-peer-quality" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling and Peer Quality
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-fetch-sequential-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concurrent Fetch + Sequential Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-quick-validation-for-checkpointed-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.3. Quick Validation for Checkpointed Blocks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.3. Quick Validation for Checkpointed Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-validation-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Validation Process
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpoint-based-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checkpoint-Based Optimization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Benefits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtree-and-transaction-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Subtree and Transaction Processing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-validating-the-subtrees" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.4. Validating the Subtrees
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225-block-data-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.5. Block Data Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-transaction-re-presentation-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.6. Transaction Re-presentation Detection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.6. Transaction Re-presentation Detection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bloom-filter-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bloom Filter Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-validorderandblessed-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        The validOrderAndBlessed Mechanism
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-fork-management-and-chain-reorganization" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.7. Fork Management and Chain Reorganization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.7. Fork Management and Chain Reorganization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fork-states-and-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork States and Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork-registration-and-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork Registration and Tracking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-fork-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallel Fork Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork Resolution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fork-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fork Cleanup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-block-priority-queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Block Priority Queue
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-block-processing-queue-and-priority-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.8. Block Processing Queue and Priority System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.8. Block Processing Queue and Priority System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#priority-levels" class="md-nav__link">
    <span class="md-ellipsis">
      
        Priority Levels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#queue-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Queue Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-source-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternative Source Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coordination-with-fork-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coordination with Fork Manager
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229-malicious-peer-detection-and-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.9. Malicious Peer Detection and Tracking
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.9. Malicious Peer Detection and Tracking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detection-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Detection Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer-quality-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Peer Quality Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer-banning-future-feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Peer Banning (Future Feature)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210-invalid-block-tracking-and-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.10. Invalid Block Tracking and Notifications
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.10. Invalid Block Tracking and Notifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-block-classification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Invalid Block Classification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-notification-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kafka Notification System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block-revalidation-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Block Revalidation Process
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-block-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Block Invalidation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2211-subtree-deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2.11. Subtree Deduplication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.11. Subtree Deduplication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-subtree-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Subtree Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-marking-txs-as-mined" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3. Marking Txs as mined
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3. Marking Txs as mined">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trigger-points-and-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trigger Points and Sequence
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-two-phase-commit" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Two-Phase Commit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsibility-and-exclusivity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Responsibility and Exclusivity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Optimization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-grpc-protobuf-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. gRPC Protobuf Definitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-data-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Data Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-technology" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Technology
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-directory-structure-and-main-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Directory Structure and Main Files
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-how-to-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. How to run
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-configuration-options-settings-flags" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Configuration options (settings flags)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-other-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Other Resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="block-validation-service"> Block Validation Service</h1>
<h2 id="index">Index</h2>
<ol>
<li><a href="#1-description">Description</a></li>
<li><a href="#2-functionality">Functionality</a><ul>
<li><a href="#21-receiving-blocks-for-validation">2.1. Receiving blocks for validation</a></li>
<li><a href="#22-validating-blocks">2.2. Validating blocks</a></li>
<li><a href="#221-overview">2.2.1. Overview</a></li>
<li><a href="#222-catching-up-after-a-parent-block-is-not-found">2.2.2. Catching up after a parent block is not found</a></li>
<li><a href="#223-quick-validation-for-checkpointed-blocks">2.2.3. Quick Validation for Checkpointed Blocks</a></li>
<li><a href="#224-validating-the-subtrees">2.2.4. Validating the Subtrees</a></li>
<li><a href="#225-block-data-validation">2.2.5. Block Data Validation</a></li>
<li><a href="#226-transaction-re-presentation-detection">2.2.6. Transaction Re-presentation Detection</a></li>
<li><a href="#23-marking-txs-as-mined">2.3. Marking Txs as mined</a></li>
</ul>
</li>
<li><a href="#3-grpc-protobuf-definitions">gRPC Protobuf Definitions</a></li>
<li><a href="#4-data-model">Data Model</a></li>
<li><a href="#5-technology">Technology</a></li>
<li><a href="#6-directory-structure-and-main-files">Directory Structure and Main Files</a></li>
<li><a href="#7-how-to-run">How to run</a></li>
<li><a href="#8-configuration-options-settings-flags">Configuration options (settings flags)</a></li>
<li><a href="#9-other-resources">Other Resources</a></li>
</ol>
<h2 id="1-description">1. Description</h2>
<p>The Block Validator is responsible for ensuring the integrity and consistency of each block before it is added to the blockchain. It performs several key functions:</p>
<ol>
<li>
<p><strong>Validation of Block Structure</strong>: Verifies that each block adheres to the defined structure and format, and that their subtrees are known and valid.</p>
</li>
<li>
<p><strong>Merkle Root Verification</strong>: Confirms that the Merkle root in the block header correctly represents the subtrees in the block, ensuring data integrity.</p>
</li>
<li>
<p><strong>Block Header Verification</strong>: Validates the block header, including the proof of work , timestamp, and reference to the previous block, maintaining the blockchain's unbroken chain.</p>
</li>
</ol>
<p><img alt="Block_Validation_Service_Container_Diagram.png" src="../img/Block_Validation_Service_Container_Diagram.png" /></p>
<p>The Block Validation Service:</p>
<ul>
<li>Receives new blocks from the Legacy Service. The Legacy Service has received them from other nodes on the network.</li>
<li>Validates the blocks, after fetching them from the remote asset server.</li>
<li>Updates stores, and notifies the blockchain service of the new block.</li>
</ul>
<p>The Legacy Service communicates with the Block Validation over the gRPC protocol.</p>
<p><img alt="Block_Validation_Service_Component_Diagram.png" src="../img/Block_Validation_Service_Component_Diagram.png" /></p>
<h3 id="detailed-component-diagram">Detailed Component Diagram</h3>
<p>The detailed component diagram below shows the internal architecture of the Block Validation Service:</p>
<p><img alt="Block_Validation_Component" src="../img/plantuml/blockvalidation/Block_Validation_Component.svg" /></p>
<blockquote>
<p><strong>Note</strong>: For information about how the Block Validation service is initialized during daemon startup and how it interacts with other services, see the <a href="../../../references/teranodeDaemonReference/#service-initialization-flow">Teranode Daemon Reference</a>.</p>
</blockquote>
<p>Finally, note that the Block Validation service benefits of the use of Lustre Fs (filesystem). Lustre is a type of parallel distributed file system, primarily used for large-scale cluster computing. This filesystem is designed to support high-performance, large-scale data storage and workloads.
Specifically for Teranode, these volumes are meant to be temporary holding locations for short-lived file-based data that needs to be shared quickly between various services
Teranode microservices make use of the Lustre file system in order to share subtree and tx data, eliminating the need for redundant propagation of subtrees over grpc or message queues. The services sharing Subtree data through this system can be seen here:</p>
<p><img alt="lustre_fs.svg" src="../img/plantuml/lustre_fs.svg" /></p>
<h2 id="2-functionality">2. Functionality</h2>
<p>The block validator is a service that validates blocks. After validating them, it will update the relevant stores and blockchain accordingly.</p>
<h3 id="21-receiving-blocks-for-validation">2.1. Receiving blocks for validation</h3>
<p><img alt="block_validation_p2p_block_found.svg" src="../img/plantuml/blockvalidation/block_validation_p2p_block_found.svg" /></p>
<ul>
<li>The Legacy Service is responsible for receiving new blocks from the network. When a new block is found, it will notify the block validation service via the <code>BlockFound()</code> gRPC endpoint.</li>
<li>The block validation service will then check if the block is already known. If not, it will start the validation process.</li>
<li>The block is added to a channel for processing. The channel is used to ensure that the block validation process is asynchronous and non-blocking.</li>
</ul>
<h3 id="22-validating-blocks">2.2. Validating blocks</h3>
<h4 id="221-overview">2.2.1. Overview</h4>
<p><img alt="block_validation_p2p_block_validation.svg" src="../img/plantuml/blockvalidation/block_validation_p2p_block_validation.svg" /></p>
<ul>
<li>As seen in the section 2.1, a new block is queued for validation in the blockFoundCh. The block validation server will pick it up and start the validation process.</li>
<li>The server will request the block data from the remote node (<code>DoHTTPRequest()</code>).</li>
<li>If the parent block is not known, it will be added to the catchupCh channel for processing. We stop at this point, as we can no longer proceed. The catchup process will be explained in the next section (section 2.2.2).</li>
<li>If the parent is known, the block will be validated.<ul>
<li>First, the service validates all the block subtrees.<ul>
<li>For each subtree, we check if it is known. If not, we kick off a subtree validation process (see section 2.2.3 for more details).</li>
</ul>
</li>
<li>The validator retrieves the last 100 block headers, which are used to validate the block data. We can see more about this specific step in the section 2.2.4.</li>
<li>The validator stores the coinbase Tx in the UTXO Store and the Tx Store.</li>
<li>The validator adds the block to the Blockchain.</li>
<li>For each Subtree in the block, the validator updates the TTL (Time To Live) to zero for the subtree. This allows the Store to clear out data the services will no longer use.</li>
<li>For each Tx for each Subtree, we set the Tx as mined in the UTXO Store. This allows the UTXO Store to know which block(s) the Tx is in.</li>
<li>Should an error occur during the validation process, the block will be invalidated and removed from the blockchain.</li>
</ul>
</li>
</ul>
<h5 id="optimistic-mining-mode">Optimistic Mining Mode</h5>
<p>The <code>optimisticMining</code> setting provides an alternative validation strategy that prioritizes block propagation speed over immediate validation completion. This experimental feature reverses the normal validate-then-add sequence.</p>
<p><strong>Normal Mode (Default):</strong></p>
<div class="highlight"><pre><span></span><code>1. Validate block (subtrees, transactions, proof of work)
2. If valid  Add to blockchain
3. Update stores and caches
4. Notify other services
</code></pre></div>
<p><strong>Optimistic Mining Mode:</strong></p>
<div class="highlight"><pre><span></span><code>1. Add block to blockchain immediately (before full validation)
2. Mark block as existing in cache
3. Validate in background goroutine:
   a. Fetch block headers for validation context
   b. Validate subtrees and transactions
   c. Update stores (subtree DAH, tx metadata)
   d. Mark transactions as mined
4. If validation fails  Queue for revalidation
</code></pre></div>
<p><strong>Technical Implementation:</strong></p>
<p>The optimistic path is implemented in <code>ValidateBlock()</code> (services/blockvalidation/BlockValidation.go:1187-1220):</p>
<ol>
<li><strong>Immediate Block Addition</strong>: Calls <code>blockchainClient.AddBlock()</code> before subtree validation completes</li>
<li><strong>Block Exists Cache</strong>: Sets block as existing to prevent reprocessing</li>
<li><strong>Background Validation</strong>: Spawns goroutine with <code>optimisticMiningWg.Add(1)</code></li>
<li><strong>Decoupled Context</strong>: Uses <code>tracing.DecoupleTracingSpan()</code> to prevent context cancellation from blocking background work</li>
<li><strong>Rollback on Failure</strong>: Calls <code>ReValidateBlock()</code> if background validation fails</li>
</ol>
<p><strong>Configuration:</strong></p>
<ul>
<li><strong>Setting</strong>: <code>blockvalidation_optimisticMining</code> (default: <code>false</code>)</li>
<li><strong>Runtime Override</strong>: Can be disabled per-block via <code>ValidateBlockOptions.DisableOptimisticMining</code></li>
<li><strong>Automatic Disable</strong>: Always disabled during catchup mode for better reliability</li>
</ul>
<p><strong>Performance Benefits:</strong></p>
<ul>
<li><strong>Faster Block Propagation</strong>: Block becomes available to Block Assembly ~100-200ms sooner</li>
<li><strong>Reduced Latency</strong>: Miners can build on new blocks before validation completes</li>
<li><strong>Higher Throughput</strong>: Decouples block acceptance from validation time</li>
</ul>
<p><strong>Risks and Tradeoffs:</strong></p>
<ol>
<li>
<p><strong>Temporary Invalid Chain State</strong>:</p>
<ul>
<li>Node may temporarily have an invalid block in its chain</li>
<li>If validation fails in background, chain state becomes inconsistent until revalidation</li>
<li>Other services (Block Assembly, Validator) may work with temporarily invalid state</li>
</ul>
</li>
<li>
<p><strong>Fork Risk</strong>:</p>
<ul>
<li>If optimistic block turns out invalid, creates temporary fork</li>
<li>Miners building on invalid block waste hash power</li>
<li>Requires chain reorganization to remove invalid block</li>
</ul>
</li>
<li>
<p><strong>Resource Waste</strong>:</p>
<ul>
<li>Background goroutines consume memory and CPU</li>
<li>May process transactions that will later be rejected</li>
<li>Stores updated with data that may need rollback</li>
</ul>
</li>
<li>
<p><strong>Revalidation Complexity</strong>:</p>
<ul>
<li>Failed blocks queued to <code>revalidateBlockChan</code></li>
<li>Revalidation retries up to 3 times</li>
<li>After retries exhausted, block marked permanently invalid</li>
</ul>
</li>
</ol>
<p><strong>When to Use Optimistic Mining:</strong></p>
<ul>
<li><strong>Performance Testing</strong>: Measure maximum throughput without validation bottleneck</li>
<li><strong>Low-Risk Environments</strong>: Test networks where temporary forks acceptable</li>
<li><strong>High-Trust Scenarios</strong>: When block sources are highly trusted (e.g., own miners)</li>
</ul>
<p><strong>NOT Recommended For:</strong></p>
<ul>
<li><strong>Production Networks</strong>: Risk of temporary chain corruption unacceptable</li>
<li><strong>Public Nodes</strong>: May propagate invalid blocks to network</li>
<li><strong>Financial Applications</strong>: Temporary invalid state could affect transaction processing</li>
</ul>
<p><strong>Future Improvements:</strong></p>
<p>The optimistic mining feature is experimental and currently disabled by default. Future enhancements may include:</p>
<ul>
<li>Better rollback mechanisms</li>
<li>Invalid block notifications to dependent services</li>
<li>Configurable risk levels (optimistic vs pessimistic thresholds)</li>
</ul>
<p>For implementation details, see <code>BlockValidation.go:ValidateBlock()</code> (lines 1146-1220).</p>
<h4 id="222-catching-up-after-a-parent-block-is-not-found">2.2.2. Catching up after a parent block is not found</h4>
<p><img alt="block_validation_p2p_block_catchup.svg" src="../img/plantuml/blockvalidation/block_validation_p2p_block_catchup.svg" /></p>
<p>When a block parent is not found in the local blockchain, the node initiates a comprehensive catchup process to synchronize with the peer's chain. This process is orchestrated through 11 distinct steps to ensure safe and validated synchronization while protecting against malicious peers.</p>
<h5 id="catchup-process-overview">Catchup Process Overview</h5>
<p>The catchup orchestration follows this step-by-step sequence (implemented in <code>catchup()</code> in <code>services/blockvalidation/catchup.go</code>):</p>
<ol>
<li><strong>Acquire catchup lock</strong> - Prevents concurrent catchups using atomic <code>isCatchingUp</code> flag</li>
<li><strong>Fetch headers from peer</strong> - Retrieves block headers using block locator pattern (<code>headers_from_common_ancestor</code> endpoint)</li>
<li><strong>Find and validate common ancestor</strong> - Locates the newest block that exists in both chains using O(log n) search</li>
<li><strong>Check coinbase maturity constraints</strong> - Validates fork depth doesn't exceed coinbase maturity (default: 100 blocks)</li>
<li><strong>Detect secret mining attempts</strong> - Checks if common ancestor is too far behind (threshold: default 10 blocks)</li>
<li><strong>Filter headers to process</strong> - Extracts only headers after the common ancestor</li>
<li><strong>Build header chain cache</strong> - Pre-computes validation headers to reduce database queries during validation</li>
<li><strong>Verify chain continuity</strong> - Ensures first block properly connects to local chain</li>
<li><strong>Verify checkpoints</strong> - Validates checkpoint hashes to confirm correct chain before proceeding</li>
<li><strong>Fetch and validate blocks</strong> - Coordinates concurrent fetching with sequential validation</li>
<li><strong>Clean up resources</strong> - Clears header chain cache and releases locks</li>
</ol>
<h5 id="fsm-state-transitions-during-catchup">FSM State Transitions During Catchup</h5>
<p>The Block Validation service manages FSM (Finite State Machine) state transitions during catchup to coordinate with other services:</p>
<p><strong>State Transition Flow:</strong></p>
<div class="highlight"><pre><span></span><code>RUNNING  CATCHINGBLOCKS  RUNNING
</code></pre></div>
<p><strong>When State Changes:</strong></p>
<ul>
<li><strong>Transition to CATCHINGBLOCKS</strong>: Triggered when new blocks extend the current main chain<ul>
<li>Calls <code>blockchainClient.CatchUpBlocks(ctx)</code> before fetching blocks</li>
<li>Prevents Block Assembly from mining during catchup</li>
<li>Disables transaction propagation to conserve resources</li>
</ul>
</li>
<li><strong>Transition back to RUNNING</strong>: Triggered after catchup completes (success or failure)<ul>
<li>Calls <code>blockchainClient.Run(ctx)</code> to restore normal operations</li>
<li>Re-enables Block Assembly and transaction processing</li>
</ul>
</li>
</ul>
<p>For more information on FSM states and their effects on services, see the <a href="../../architecture/stateManagement/">State Management</a> documentation.</p>
<h5 id="header-chain-cache">Header Chain Cache</h5>
<p>To optimize block validation performance during catchup, the service builds a header chain cache before fetching full blocks:</p>
<p><strong>Cache Building Process:</strong></p>
<ol>
<li>Takes all headers that need to be processed (headers after common ancestor)</li>
<li>Calls <code>headerChainCache.BuildFromHeaders(blockHeaders, previousBlockHeaderCount)</code></li>
<li>Pre-computes validation headers for each block (typically last 11 headers for MTP calculation)</li>
<li>Stores in memory for O(1) lookup during validation</li>
</ol>
<p><strong>Performance Benefits:</strong></p>
<ul>
<li>Eliminates repeated database queries for previous headers during validation</li>
<li>Reduces validation latency during catchup</li>
<li>Particularly effective when catching up on hundreds or thousands of blocks</li>
</ul>
<h5 id="checkpoint-verification">Checkpoint Verification</h5>
<p>Before fetching full block data, the catchup process verifies checkpoints to ensure the peer is on the correct chain:</p>
<p><strong>Verification Steps:</strong></p>
<ol>
<li><strong>Get Configured Checkpoints</strong>: Reads checkpoints from <code>ChainCfgParams.Checkpoints</code></li>
<li><strong>Determine Header Range</strong>: Calculates which checkpoints fall within the headers to be processed</li>
<li>
<p><strong>Verify Each Checkpoint</strong>: For each checkpoint in range:</p>
<ul>
<li>Maps checkpoint height to header index</li>
<li>Compares checkpoint hash with actual header hash</li>
<li>Fails catchup immediately if any checkpoint doesn't match</li>
<li><strong>Record Results</strong>: Logs number of checkpoints verified</li>
</ul>
</li>
</ol>
<p><strong>Checkpoint-Based Quick Validation:</strong></p>
<ul>
<li>If all checkpoints verify and blocks are below highest checkpoint, quick validation can be used</li>
<li>Quick validation creates UTXOs and spends transactions in parallel (2-phase process)</li>
<li>Approximately 10x faster than full validation for historical blocks</li>
<li>Currently disabled pending additional testing (<code>useQuickValidation = false</code>)</li>
</ul>
<p><strong>Safety Guarantees:</strong></p>
<p>Checkpoint verification ensures:</p>
<ul>
<li>Cannot be tricked onto a fake chain with valid proof of work</li>
<li>Detects chain forks before downloading gigabytes of block data</li>
<li>Provides early exit for catchup from malicious peers</li>
</ul>
<h5 id="peer-quality-tracking">Peer Quality Tracking</h5>
<p>The catchup process maintains detailed metrics on peer behavior to detect and mitigate malicious activity:</p>
<p><strong>Metrics Tracked Per Peer:</strong></p>
<ul>
<li><strong>Malicious Attempts</strong>: Count of detected malicious behaviors (secret mining, invalid blocks)</li>
<li><strong>Catchup Successes/Failures</strong>: Success rate for catchup operations from this peer</li>
<li><strong>Validation Failures</strong>: Number of blocks from peer that failed consensus validation</li>
<li><strong>Response Times</strong>: How quickly peer responds to header/block requests</li>
</ul>
<p><strong>Malicious Behavior Detection:</strong></p>
<p>The system detects and records:</p>
<ol>
<li><strong>Secret Mining</strong>: Common ancestor more than <code>secret_mining_threshold</code> blocks behind (default: 10)</li>
<li><strong>Coinbase Maturity Violation</strong>: Fork depth exceeds coinbase maturity (default: 100 blocks)</li>
<li><strong>Invalid Block Propagation</strong>: Blocks that fail consensus validation (PoW, merkle root, timestamps)</li>
<li><strong>Checkpoint Mismatch</strong>: Peer provides chain with incorrect checkpoint hashes</li>
</ol>
<p><strong>Metrics Recording:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">peerMetric</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">peerMetrics</span><span class="p">.</span><span class="nx">GetOrCreatePeerMetrics</span><span class="p">(</span><span class="nx">peerID</span><span class="p">)</span>
<span class="nx">peerMetric</span><span class="p">.</span><span class="nx">RecordMaliciousAttempt</span><span class="p">()</span>
</code></pre></div>
<p>These metrics feed into the circuit breaker pattern (see Section 2.2.9) to temporarily or permanently avoid problematic peers.</p>
<h5 id="error-handling-and-peer-quality">Error Handling and Peer Quality</h5>
<p><strong>Invalid Block Classification:</strong></p>
<p>During catchup, blocks are only marked as invalid (<code>invalid=true</code>) for consensus violations:</p>
<ul>
<li>Proof of work failures (hash doesn't meet target)</li>
<li>Merkle root mismatches</li>
<li>Timestamp violations</li>
<li>Transaction ordering or uniqueness violations</li>
</ul>
<p><strong>Recoverable Errors:</strong></p>
<p>Blocks are NOT marked invalid for:</p>
<ul>
<li>Missing subtrees or transaction data (can be recovered)</li>
<li>Network timeouts or temporary storage failures</li>
<li>Processing errors that may succeed on retry</li>
</ul>
<p><strong>Peer Banning (Logged, Not Implemented):</strong></p>
<p>When malicious behavior is detected, the system logs:</p>
<div class="highlight"><pre><span></span><code>SECURITY: Peer &lt;peerID&gt; attempted secret mining - should be banned (banning not yet implemented)
</code></pre></div>
<p>This provides an audit trail for operators and prepares for future automatic banning.</p>
<h5 id="concurrent-fetch-sequential-validation">Concurrent Fetch + Sequential Validation</h5>
<p>The catchup process optimizes performance by fetching blocks concurrently while validating them sequentially:</p>
<p><strong>Coordination Pattern:</strong></p>
<ol>
<li><strong>Error Group</strong>: Creates <code>errgroup.WithContext()</code> to manage two concurrent goroutines</li>
<li><strong>Fetch Goroutine</strong>: Fetches blocks from peer and sends to <code>validateBlocksChan</code><ul>
<li>Fetches blocks concurrently (respects rate limits)</li>
<li>Sends blocks to channel in order</li>
<li>Closes channel when all blocks fetched</li>
</ul>
</li>
<li><strong>Validation Goroutine</strong>: Reads from channel and validates blocks sequentially<ul>
<li>Maintains chain order by validating in sequence</li>
<li>Uses cached headers for performance</li>
<li>Updates atomic counter after each block</li>
</ul>
</li>
<li><strong>Error Handling</strong>: Either goroutine error terminates both via shared context</li>
</ol>
<p><strong>Benefits:</strong></p>
<ul>
<li>Maximizes network and CPU utilization</li>
<li>Reduces total catchup time by ~50-60%</li>
<li>Maintains chain integrity through sequential validation</li>
<li>Provides early termination on first error</li>
</ul>
<p><strong>Progress Tracking:</strong></p>
<p>The system logs progress every 100 blocks:</p>
<div class="highlight"><pre><span></span><code>[catchup] validating block &lt;hash&gt; 100/1000
[catchup] 900 blocks remaining
</code></pre></div>
<p>For implementation details, see <code>catchup.go:fetchAndValidateBlocks()</code> (lines 554-612).</p>
<p><strong>Sync Coordination and Peer Selection:</strong></p>
<p>The catchup process integrates with the P2P service's peer registry and reputation system to select optimal peers for block retrieval:</p>
<ol>
<li>
<p><strong>Peer Selection</strong>: The sync coordinator uses <code>SelectSyncPeer</code> to choose the best peer based on:</p>
<ul>
<li>Reputation score (minimum 20.0 threshold)</li>
<li>Storage mode (full nodes preferred over pruned)</li>
<li>Blockchain height (must be ahead of local node)</li>
<li>Response time history</li>
<li>Recent interaction success rate</li>
</ul>
</li>
<li>
<p><strong>Reputation Updates</strong>: Peer reputation is updated based on catchup results:</p>
<ul>
<li>Successful block retrieval increases reputation</li>
<li>Invalid blocks result in severe reputation penalty (malicious marking)</li>
<li>Timeouts and failures decrease reputation</li>
</ul>
</li>
<li>
<p><strong>Peer Rotation</strong>: If a peer consistently fails during catchup:</p>
<ul>
<li>System automatically rotates to the next best peer</li>
<li>Failed peer enters cooldown period before retry</li>
<li>Exponential backoff for repeated failures</li>
</ul>
</li>
</ol>
<p><strong>Performance Optimizations:</strong></p>
<p>The catchup process includes several performance optimizations:</p>
<ul>
<li><strong>Concurrent Header Fetching</strong>: Block headers are fetched in parallel before full block retrieval</li>
<li><strong>Batch Block Processing</strong>: Multiple blocks are processed in configurable batch sizes</li>
<li><strong>Adaptive Concurrency</strong>: Processing parallelism adjusts based on system load</li>
<li><strong>Smart Peer Selection</strong>: Preferentially uses peers with lowest latency and highest success rates</li>
</ul>
<p>For configuration of catchup performance settings, see the <a href="../../../references/settings/services/blockvalidation_settings/">Block Validation Settings Reference</a>.</p>
<p>For details on the peer reputation system, see <a href="../../features/peer_registry_reputation/">Peer Registry and Reputation System</a>.</p>
<h4 id="223-quick-validation-for-checkpointed-blocks">2.2.3. Quick Validation for Checkpointed Blocks</h4>
<p>For blocks that are below known checkpoints in the blockchain, the Block Validation service employs an optimized quick validation path that significantly improves synchronization performance. This mechanism is particularly effective during initial blockchain synchronization.</p>
<p><img alt="quick_validation.svg" src="../img/plantuml/blockvalidation/quick_validation.svg" /></p>
<h5 id="quick-validation-process">Quick Validation Process</h5>
<p>The quick validation system operates in two distinct phases implemented in <code>quickValidateBlock()</code> in <code>services/blockvalidation/quick_validate.go</code>:</p>
<p><strong>Phase 1: UTXO Creation (<code>createAllUTXOs()</code>)</strong></p>
<p>All UTXOs for the block's transactions are created in parallel before validation:</p>
<ol>
<li><strong>BlockID Stability</strong>: Before creating UTXOs, checks if first transaction already exists with a BlockID<ul>
<li>On retry scenarios, reuses existing BlockID to maintain consistency</li>
<li>Prevents BlockID conflicts when recovering from failures</li>
</ul>
</li>
<li><strong>Synchronous First Transaction</strong>: Creates first transaction synchronously to establish BlockID anchor<ul>
<li>Ensures BlockID is committed before parallel operations</li>
<li>Provides stable reference point for retry detection</li>
</ul>
</li>
<li><strong>Parallel UTXO Creation</strong>: Remaining transactions processed concurrently<ul>
<li>Concurrency limited by <code>UtxoStore.StoreBatcherSize * 2</code></li>
<li>Each UTXO created with <code>locked=true</code> flag (two-phase commit)</li>
<li>UTXOs created with block ID and mined status pre-set</li>
<li>Gracefully handles <code>ErrTxExists</code> for recovery scenarios</li>
</ul>
</li>
</ol>
<p><strong>Phase 2: Transaction Spending (<code>spendAllTransactions()</code>)</strong></p>
<p>Validates transactions by spending their inputs in parallel:</p>
<ol>
<li><strong>Parallel Spending</strong>: All transactions validated concurrently<ul>
<li>Concurrency limited by <code>SpendBatcherSize * SpendBatcherConcurrency</code></li>
<li>Uses <code>IgnoreLocked: true</code> flag to spend from UTXOs created in Phase 1</li>
</ul>
</li>
<li><strong>Validation Optimization</strong>: Skips expensive script validation for checkpointed blocks<ul>
<li>Checkpoints guarantee these blocks are valid</li>
<li>Focuses on UTXO state consistency rather than script execution</li>
</ul>
</li>
</ol>
<p><strong>Final Steps:</strong></p>
<ol>
<li><strong>Add Block to Blockchain</strong>: Block added with <code>SubtreesSet=true</code> and <code>MinedSet=true</code></li>
<li><strong>Unlock UTXOs</strong>: Calls <code>SetLocked(txHashes, false)</code> to complete two-phase commit</li>
<li><strong>Mark Block Exists</strong>: Updates local cache to prevent reprocessing</li>
</ol>
<h5 id="checkpoint-based-optimization">Checkpoint-Based Optimization</h5>
<p>The quick validation path is only applied to blocks below verified checkpoints:</p>
<ul>
<li><strong>Checkpoint Verification</strong>: During catchup, checkpoints are verified in header chain (see Section 2.2.2)</li>
<li><strong>Eligibility Check</strong>: <code>block.Height &lt;= highestCheckpointHeight</code> determines if quick validation can be used</li>
<li><strong>Trust Assumption</strong>: Blocks below checkpoints are known to be valid, allowing optimized processing</li>
<li><strong>Current Status</strong>: Quick validation currently disabled (<code>useQuickValidation = false</code>) pending additional testing</li>
</ul>
<h5 id="performance-benefits">Performance Benefits</h5>
<p>Quick validation provides substantial performance improvements:</p>
<ul>
<li><strong>10x Faster</strong>: Approximately 10x faster processing for historical blocks below checkpoints</li>
<li><strong>Parallel Operations</strong>: UTXO creation and spending both use maximum concurrency</li>
<li><strong>Skip Script Validation</strong>: Eliminates most expensive validation step for known-valid blocks</li>
<li><strong>Reduced Memory</strong>: On-demand transaction extension minimizes memory footprint</li>
</ul>
<h5 id="subtree-and-transaction-processing">Subtree and Transaction Processing</h5>
<p>During quick validation, the system reconstructs subtree files and extends transactions on-demand (implemented in <code>getBlockTransactions()</code>):</p>
<p><strong>Subtree File Generation:</strong></p>
<p>For each subtree in the block, the system:</p>
<ol>
<li><strong>Reads <code>.subtreeToCheck</code></strong>: Fetches subtree structure with transaction IDs</li>
<li><strong>Reads <code>.subtreeData</code></strong>: Fetches raw transaction data</li>
<li><strong>Validates Coinbase</strong>: Ensures first transaction in first subtree is coinbase</li>
<li><strong>Reconstructs <code>.subtree</code></strong>: If missing, creates full subtree with fee and size information<ul>
<li>Adds each transaction node with metadata from transaction</li>
<li>Stores complete subtree for future use</li>
</ul>
</li>
<li><strong>Generates <code>.subtreeMeta</code></strong>: If missing, creates metadata file with transaction inpoints<ul>
<li>Stores input relationships for efficient lookups</li>
<li>Used by subtree validation service</li>
</ul>
</li>
</ol>
<p><strong>Transaction Extension:</strong></p>
<p>Transactions in standard Bitcoin format are extended in-memory for validation:</p>
<ol>
<li><strong>Extension Detection</strong>: Checks each transaction with <code>tx.IsExtended()</code></li>
<li>
<p><strong>Parent Lookup</strong>: For non-extended transactions:</p>
<ul>
<li>Searches for parent transactions within same block first</li>
<li>Falls back to UTXO store for external parents</li>
<li>Waits for parent extension if it's being processed concurrently</li>
<li><strong>Input Population</strong>: Sets <code>PreviousTxSatoshis</code> and <code>PreviousTxScript</code> for each input</li>
<li><strong>Concurrency Control</strong>: Uses errgroup with configurable limits (<code>GetBlockTransactionsConcurrency</code>)</li>
</ul>
</li>
</ol>
<p><strong>Merkle Root Verification:</strong></p>
<p>After processing all transactions, the system verifies:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">CheckMerkleRoot</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">NewProcessingError</span><span class="p">(</span><span class="s">&quot;merkle root mismatch&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>This ensures the transactions match the block header before proceeding.</p>
<p><strong>Error Handling:</strong></p>
<p>If quick validation encounters any errors:</p>
<ul>
<li>Removes <code>.subtree</code> files to force reprocessing</li>
<li>Falls back to normal validation automatically</li>
<li>Normal validation re-creates UTXOs and validates with full script execution</li>
</ul>
<p>For implementation details, see <code>quick_validate.go</code> in <code>services/blockvalidation/</code>.</p>
<h4 id="224-validating-the-subtrees">2.2.4. Validating the Subtrees</h4>
<p>Should the validation process for a block encounter a subtree it does not know about, it can request its processing off the Subtree Validation service.</p>
<p><img alt="block_validation_subtree_validation_request.svg" src="../img/plantuml/subtreevalidation/block_validation_subtree_validation_request.svg" /></p>
<p>If any transaction under the subtree is also missing, the subtree validation process will kick off a recovery process for those transactions.</p>
<h4 id="225-block-data-validation">2.2.5. Block Data Validation</h4>
<p>As part of the overall block validation, the service will validate the block data, ensuring the format and integrity of the data, as well as confirming that coinbase tx, subtrees and transactions are valid. This is done in the <code>Valid()</code> method under the <code>Block</code> struct.</p>
<p><img alt="block_data_validation.svg" src="../img/plantuml/blockvalidation/block_data_validation.svg" /></p>
<p>Effectively, the following validations are performed:</p>
<ul>
<li>
<p>The hash of the previous block must be known and valid. Teranode must always build a block on a previous block that it recognizes as the longest chain.</p>
</li>
<li>
<p>The Proof of Work of a block must satisfy the difficulty target (Proof of Work higher than nBits in block header).</p>
</li>
<li>
<p>The Merkle root of all transactions in a block must match the value of the Merkle root in the block header.</p>
</li>
<li>
<p>A block must include at least one transaction, which is the Coinbase transaction.</p>
</li>
<li>
<p>A block timestamp must not be too far in the past or the future.</p>
<ul>
<li>The block time specified in the header must be larger than the Median-Time-Past (MTP) calculated from the previous block index. MTP is calculated by taking the timestamps of the last 11 blocks and finding the median (More details in BIP113).</li>
<li>The block time specified in the header must not be larger than the adjusted current time plus two hours ("maximum future block time").</li>
</ul>
</li>
<li>
<p>The first transaction in a block must be Coinbase. The transaction is Coinbase if the following requirements are satisfied:</p>
<ul>
<li>The Coinbase transaction has exactly one input.</li>
<li>The input is null, meaning that the input's previous hash is 00000000 and the input's previous index is 0xFFFFFFFF.</li>
<li>The Coinbase transaction must start with the serialized block height, to ensure block and transaction uniqueness.</li>
</ul>
</li>
<li>
<p>The Coinbase transaction amount may not exceed block subsidy and all transaction fees (block reward).</p>
</li>
</ul>
<h4 id="226-transaction-re-presentation-detection">2.2.6. Transaction Re-presentation Detection</h4>
<p>The Block Validation service implements a robust mechanism for detecting re-presented transactions using bloom filters. This mechanism, implemented in the <code>validOrderAndBlessed</code> function, is critical for preventing double-spending and ensuring transaction integrity in the blockchain.</p>
<p><img alt="bloom_filter_validation.svg" src="../img/plantuml/blockvalidation/bloom_filter_validation.svg" /></p>
<h5 id="bloom-filter-implementation">Bloom Filter Implementation</h5>
<p>Teranode maintains bloom filters for recent blocks to efficiently detect re-presented transactions:</p>
<ul>
<li><strong>Creation</strong>: Each validated block generates a bloom filter containing all of its transaction hashes</li>
<li><strong>Storage</strong>: Bloom filters are stored in both memory (for active validation) and in the subtree store (for persistence)</li>
<li><strong>Retention</strong>: Filters are maintained for a configurable number of recent blocks (<code>blockvalidation_bloom_filter_retention_size</code>)</li>
<li><strong>TTL Ordering</strong>: The system enforces a strict TTL (Time-To-Live) ordering: txmetacache &lt; utxo store &lt; bloom filter<ul>
<li>This ensures that even if a transaction is pruned from txmetacache, the bloom filter can still detect its re-presentation</li>
<li>The longer retention period for bloom filters provides an extended window for detecting re-presented transactions</li>
</ul>
</li>
</ul>
<h5 id="the-validorderandblessed-mechanism">The validOrderAndBlessed Mechanism</h5>
<p>The <code>validOrderAndBlessed</code> function performs several critical validations during block processing:</p>
<ol>
<li>
<p><strong>Transaction Ordering Validation</strong>:</p>
<ul>
<li>Ensures child transactions appear after their parent transactions within the same block</li>
<li>For each transaction, verifies that all of its parent transactions either appear earlier in the same block or exist in a previous block on the current chain</li>
</ul>
</li>
<li>
<p><strong>Re-presented Transaction Detection</strong>:</p>
<ul>
<li>Efficiently checks if transactions have already been mined in the current chain using bloom filters</li>
<li>For potential matches in the bloom filter (which may include false positives), performs definitive verification against the txMetaStore</li>
<li>Rejects blocks containing transactions that have already been mined in the current chain</li>
</ul>
</li>
<li>
<p><strong>Duplicate Input Prevention</strong>:</p>
<ul>
<li>Tracks all inputs being spent within the block to detect duplicate spends</li>
<li>If a transaction is found to be already mined in another block on the same chain, the new block is marked as invalid</li>
<li>Ensures no two transactions in the block spend the same input</li>
</ul>
</li>
<li>
<p><strong>Orphaned Transaction Prevention</strong>:</p>
<ul>
<li>Verifies that parent transactions of each transaction either exist in the current block (before the child) or in a previous block on the current chain</li>
<li>Prevents situations where transactions depend on parents that don't exist or aren't accessible</li>
</ul>
</li>
</ol>
<p>This comprehensive validation mechanism operates with high concurrency (configurable via <code>block_validOrderAndBlessedConcurrency</code>) to maintain performance while ensuring the integrity of the blockchain by preventing double-spends and transaction re-presentations.</p>
<h4 id="227-fork-management-and-chain-reorganization">2.2.7. Fork Management and Chain Reorganization</h4>
<p>The Block Validation service implements a sophisticated fork manager to track and manage parallel chain branches that may occur during blockchain operation. This system is critical for handling chain reorganizations and ensuring the node selects and maintains the correct chain.</p>
<h5 id="fork-states-and-lifecycle">Fork States and Lifecycle</h5>
<p>The fork manager tracks forks through four distinct states:</p>
<ul>
<li><strong>Active</strong>: Fork is currently being processed and built upon</li>
<li><strong>Stale</strong>: Fork has had no activity for an extended period (default: 1 hour)</li>
<li><strong>Resolved</strong>: Fork has been resolved to the main chain or abandoned</li>
<li><strong>Orphaned</strong>: Fork is too far behind the main chain (beyond coinbase maturity)</li>
</ul>
<h5 id="fork-registration-and-tracking">Fork Registration and Tracking</h5>
<p>When a block arrives whose parent is not on the current chain tip, the fork manager:</p>
<ol>
<li><strong>Determines Fork ID</strong>: Uses <code>DetermineForkID()</code> to check if the block belongs to an existing fork or creates a new one</li>
<li><strong>Registers Fork</strong>: Creates a new <code>ForkBranch</code> with base hash (common ancestor), base height, and creation timestamp</li>
<li><strong>Adds Blocks</strong>: Tracks all blocks belonging to each fork in sequential order</li>
<li><strong>Updates Metrics</strong>: Records fork creation, depth, and lifetime metrics</li>
</ol>
<h5 id="parallel-fork-processing">Parallel Fork Processing</h5>
<p>The fork manager enforces limits on concurrent fork processing to prevent resource exhaustion:</p>
<ul>
<li><strong>maxParallelForks</strong>: Maximum number of forks that can be processed simultaneously (default: 4, configurable via <code>blockvalidation_maxParallelForks</code>)</li>
<li><strong>maxTrackedForks</strong>: Maximum total number of forks to track (default: 1000, configurable via <code>blockvalidation_maxTrackedForks</code>)</li>
<li><strong>BlockProcessingGuard</strong>: Automatic cleanup mechanism using Go finalizers to ensure processing locks are always released</li>
</ul>
<p>The guard pattern ensures that even if a panic occurs, the processing lock is released:</p>
<div class="highlight"><pre><span></span><code><span class="nx">guard</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">forkManager</span><span class="p">.</span><span class="nx">MarkBlockProcessing</span><span class="p">(</span><span class="nx">blockHash</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="p">}</span>
<span class="k">defer</span><span class="w"> </span><span class="nx">guard</span><span class="p">.</span><span class="nx">Release</span><span class="p">()</span>
<span class="c1">// Process block</span>
</code></pre></div>
<h5 id="fork-resolution">Fork Resolution</h5>
<p>Forks are resolved when:</p>
<ol>
<li><strong>Main Chain Updated</strong>: A fork block becomes the new main chain tip</li>
<li><strong>Checkpoint Verification</strong>: Fork passes through a known checkpoint</li>
<li><strong>Manual Resolution</strong>: Operator triggers reconsideration</li>
</ol>
<p>When a fork is resolved, the fork manager:</p>
<ul>
<li>Marks fork state as <code>Resolved</code></li>
<li>Notifies registered callbacks with resolution details</li>
<li>Records resolution metrics (depth, lifetime, outcome)</li>
<li>Schedules cleanup after grace period (5 minutes)</li>
</ul>
<h5 id="fork-cleanup">Fork Cleanup</h5>
<p>The fork manager runs an automatic cleanup routine (configurable interval, default: 5 minutes) that:</p>
<ul>
<li>Removes resolved forks after grace period</li>
<li>Abandons stale forks with no activity</li>
<li>Orphans forks too far behind main chain</li>
<li>Applies retention policy to limit memory usage</li>
<li>Updates aggregate metrics (average depth, longest fork, etc.)</li>
</ul>
<h5 id="integration-with-block-priority-queue">Integration with Block Priority Queue</h5>
<p>The fork manager coordinates with the block priority queue to:</p>
<ul>
<li>Signal when processing slots become available (<code>priorityQueue.Signal()</code>)</li>
<li>Track which blocks are currently being processed per fork</li>
<li>Prevent concurrent processing of blocks from the same fork</li>
<li>Requeue blocks from abandoned forks for retry with alternative sources</li>
</ul>
<p>For implementation details, see <code>fork_manager.go</code> in <code>services/blockvalidation/</code>.</p>
<h4 id="228-block-processing-queue-and-priority-system">2.2.8. Block Processing Queue and Priority System</h4>
<p>The Block Validation service uses a sophisticated priority queue system to manage the order in which blocks are validated. This ensures that blocks are processed efficiently while handling retries and alternative sources when validation fails.</p>
<h5 id="priority-levels">Priority Levels</h5>
<p>Blocks are assigned one of three priority levels:</p>
<ul>
<li><strong>PriorityHigh</strong>: Blocks on the current main chain or from trusted sources</li>
<li><strong>PriorityMedium</strong>: Blocks that are 1-2 blocks ahead of current tip</li>
<li><strong>PriorityLow</strong>: Blocks further ahead or on side chains</li>
</ul>
<p>The priority determines the order in which blocks are selected for validation when multiple blocks are waiting.</p>
<h5 id="queue-operations">Queue Operations</h5>
<p><strong>Adding Blocks:</strong></p>
<p>When a new block is discovered via <code>BlockFound()</code>:</p>
<ol>
<li>Block is assigned a priority based on its height and relationship to current chain</li>
<li>Added to the priority queue with retry count initialized to 0</li>
<li>If queue is full or limits exceeded, block may be rejected</li>
</ol>
<p><strong>Retrieving Blocks:</strong></p>
<p>The <code>WaitForBlock()</code> method:</p>
<ol>
<li>Checks fork manager to ensure processing limits not exceeded</li>
<li>Selects highest priority block that can be processed</li>
<li>Returns block to worker for validation</li>
<li>Blocks waiting if no blocks available (with timeout)</li>
</ol>
<h5 id="retry-mechanism">Retry Mechanism</h5>
<p>When block validation fails due to transient errors:</p>
<ol>
<li><strong>RequeueForRetry()</strong>: Adds block back to queue with incremented retry count</li>
<li><strong>Exponential Backoff</strong>: Each retry waits longer before reprocessing</li>
<li><strong>Retry Limits</strong>: Maximum retries configurable (default: 3)</li>
<li><strong>Alternative Sources</strong>: After failures, attempts to fetch from different peers</li>
</ol>
<h5 id="alternative-source-handling">Alternative Source Handling</h5>
<p>The <code>GetAlternativeSource()</code> method:</p>
<ul>
<li>Tracks which peer provided the block</li>
<li>On validation failure, marks peer as potentially problematic</li>
<li>Searches for alternative peers that may have the same block</li>
<li>Fetches block data from alternative source if available</li>
<li>Updates peer quality metrics via circuit breaker</li>
</ul>
<h5 id="coordination-with-fork-manager">Coordination with Fork Manager</h5>
<p>The priority queue integrates tightly with the fork manager:</p>
<ul>
<li>Checks <code>CanProcessBlock()</code> before returning blocks to workers</li>
<li>Respects parallel fork processing limits</li>
<li>Receives signals when processing slots become available</li>
<li>Maintains block-to-fork mappings for efficient lookups</li>
</ul>
<p>For implementation details, see <code>block_priority.go</code> in <code>services/blockvalidation/</code>.</p>
<h4 id="229-malicious-peer-detection-and-tracking">2.2.9. Malicious Peer Detection and Tracking</h4>
<p>The Block Validation service implements comprehensive peer quality tracking to detect and mitigate malicious behavior during block synchronization and catchup operations.</p>
<h5 id="detection-mechanisms">Detection Mechanisms</h5>
<p><strong>Secret Mining Detection:</strong></p>
<p>The service detects potential secret mining attacks during catchup by checking if:</p>
<ul>
<li>Common ancestor is more than <code>blockvalidation_secret_mining_threshold</code> blocks behind current tip (default: 10)</li>
<li>Peer withheld blocks to build a secret chain</li>
<li>Fork depth exceeds expected values for honest mining</li>
</ul>
<p>When detected:</p>
<div class="highlight"><pre><span></span><code>1. Log security warning with peer ID and reason
2. Record malicious attempt in peer metrics
3. Update circuit breaker for that peer
4. Reject the catchup operation
5. Ban peer (when banning implemented)
</code></pre></div>
<p><strong>Coinbase Maturity Violation:</strong></p>
<p>During catchup, the service validates that:</p>
<ul>
<li>Fork depth does not exceed coinbase maturity (default: 100 blocks)</li>
<li>Prevents chain reorganizations that could invalidate spent coinbase outputs</li>
<li>Protects against attacks attempting to reverse deep transactions</li>
</ul>
<p><strong>Invalid Block Propagation:</strong></p>
<p>The service tracks peers that provide:</p>
<ul>
<li>Blocks that fail consensus validation</li>
<li>Blocks with invalid proof of work</li>
<li>Blocks that violate checkpoint hashes</li>
<li>Blocks that fail merkle root verification</li>
</ul>
<h5 id="peer-quality-metrics">Peer Quality Metrics</h5>
<p>The <code>PeerCircuitBreakers</code> and <code>CatchupMetrics</code> systems track:</p>
<ul>
<li><strong>Malicious Attempts</strong>: Count of detected malicious behaviors</li>
<li><strong>Invalid Blocks</strong>: Number of invalid blocks from this peer</li>
<li><strong>Failed Validations</strong>: Transient failures vs consensus violations</li>
<li><strong>Response Times</strong>: How quickly peer responds to requests</li>
<li><strong>Success Rate</strong>: Percentage of successful validations from this peer</li>
</ul>
<h5 id="circuit-breaker-pattern">Circuit Breaker Pattern</h5>
<p>When a peer's quality score falls below threshold:</p>
<ol>
<li><strong>Circuit Opens</strong>: Requests to this peer are temporarily blocked</li>
<li><strong>Retry Delay</strong>: Exponential backoff before retrying the peer</li>
<li><strong>Alternative Sources</strong>: System uses other peers for block fetching</li>
<li><strong>Circuit Half-Open</strong>: After delay, allows limited test requests</li>
<li><strong>Circuit Closes</strong>: If peer recovers, full access restored</li>
</ol>
<h5 id="peer-banning-future-feature">Peer Banning (Future Feature)</h5>
<p>The system logs when peers should be banned but doesn't yet implement automatic banning:</p>
<div class="highlight"><pre><span></span><code>SECURITY: Peer &lt;ID&gt; attempted secret mining - should be banned (banning not yet implemented)
</code></pre></div>
<p>This provides an audit trail for operators to manually ban malicious peers and prepares for future automatic banning implementation.</p>
<p>For implementation details, see <code>malicious_peer_handling_test.go</code> and peer tracking code in <code>catchup.go</code>.</p>
<h4 id="2210-invalid-block-tracking-and-notifications">2.2.10. Invalid Block Tracking and Notifications</h4>
<p>The Block Validation service provides comprehensive tracking and notification when blocks fail validation, distinguishing between consensus violations and recoverable errors.</p>
<h5 id="invalid-block-classification">Invalid Block Classification</h5>
<p><strong>Consensus Violations (Marked Invalid):</strong></p>
<p>Blocks are marked as invalid and stored in the blockchain with <code>invalid=true</code> when they violate:</p>
<ul>
<li>Proof of work requirements (nBits incorrect or hash doesn't meet target)</li>
<li>Merkle root mismatch</li>
<li>Timestamp constraints (too far in past/future, MTP violation)</li>
<li>Coinbase structure rules</li>
<li>Block size limits</li>
<li>Transaction ordering or uniqueness rules</li>
<li>Re-presentation of already-mined transactions</li>
</ul>
<p><strong>Recoverable Errors (Not Marked Invalid):</strong></p>
<p>Blocks are NOT marked invalid for:</p>
<ul>
<li>Missing subtrees or transaction data (can be recovered)</li>
<li>Temporary storage failures</li>
<li>Network timeouts</li>
<li>Processing errors that may succeed on retry</li>
<li>Missing parent blocks (catchup can resolve)</li>
</ul>
<h5 id="kafka-notification-system">Kafka Notification System</h5>
<p>When a block is marked invalid due to consensus violation:</p>
<ol>
<li><strong>Create Message</strong>: <code>KafkaInvalidBlockTopicMessage</code> with block hash and reason</li>
<li><strong>Async Publishing</strong>: Message published to Kafka topic in background</li>
<li><strong>Topic Configuration</strong>: Controlled by <code>kafka_InvalidBlocks</code> setting</li>
<li>
<p><strong>Message Format</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaInvalidBlockTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">block_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Subscribers</strong>: Other services or monitoring systems can subscribe to track invalid blocks</p>
</li>
</ol>
<p>The Kafka producer is initialized at service startup if the topic is configured:</p>
<ul>
<li>Non-blocking async publishing ensures validation performance not impacted</li>
<li>Producer has message buffer (default: 100 messages)</li>
<li>Failed publishes are logged but don't block validation</li>
</ul>
<h5 id="block-revalidation-process">Block Revalidation Process</h5>
<p>For blocks that fail validation due to recoverable errors, the service queues them for revalidation:</p>
<p><strong>Revalidation Trigger:</strong></p>
<p>When <code>ValidateBlock()</code> encounters non-consensus errors:</p>
<div class="highlight"><pre><span></span><code><span class="nx">u</span><span class="p">.</span><span class="nx">ReValidateBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">baseURL</span><span class="p">)</span>
</code></pre></div>
<p>This queues the block to the <code>revalidateBlockChan</code> channel.</p>
<p><strong>Revalidation Worker:</strong></p>
<p>A background goroutine processes the revalidation queue:</p>
<ol>
<li><strong>Fetch Fresh Headers</strong>: Gets latest block headers (may have changed)</li>
<li><strong>Re-validate Subtrees</strong>: Attempts subtree validation again</li>
<li><strong>Full Validation</strong>: Runs complete block validation with fresh state</li>
<li><strong>Retry Logic</strong>: Up to 3 retry attempts with increasing delays</li>
<li>
<p><strong>Final Outcome</strong>:</p>
<ul>
<li>Success: Block accepted into blockchain</li>
<li>Failure after retries: Block marked invalid</li>
</ul>
</li>
</ol>
<p><strong>Retry Limits:</strong></p>
<ul>
<li>Maximum retries: 3 (hardcoded in revalidation worker)</li>
<li>Delay between retries: Managed by revalidation channel</li>
<li>After exhausting retries: Block marked invalid to prevent infinite retry loops</li>
</ul>
<h5 id="integration-with-block-invalidation">Integration with Block Invalidation</h5>
<p>The <code>markBlockAsInvalid()</code> function:</p>
<ol>
<li>Logs invalidation event with block hash and reason</li>
<li>Calls <code>kafkaNotifyBlockInvalid()</code> to publish event</li>
<li>Calls <code>blockchainClient.InvalidateBlock()</code> to mark in database</li>
<li>Updates metrics for tracking</li>
</ol>
<p>For implementation details, see <code>InvalidBlocksKafkaProducer_test.go</code> and <code>BlockValidation.go</code> (<code>markBlockAsInvalid()</code>, <code>kafkaNotifyBlockInvalid()</code>, <code>reValidateBlock()</code>).</p>
<h4 id="2211-subtree-deduplication">2.2.11. Subtree Deduplication</h4>
<p>The Block Validation service implements a deduplication system to prevent redundant processing of subtrees that may arrive from multiple sources simultaneously.</p>
<h5 id="purpose">Purpose</h5>
<p>During block propagation and validation:</p>
<ul>
<li>Multiple peers may send the same subtree</li>
<li>Subtree validation requests may be duplicated</li>
<li>Parallel block processing may request same subtrees</li>
<li>Network retries may resend subtree data</li>
</ul>
<p>The <code>DeDuplicator</code> prevents wasted processing by ensuring each subtree is validated only once.</p>
<h5 id="implementation">Implementation</h5>
<p><strong>TTL-Based Tracking:</strong></p>
<p>The deduplicator maintains a time-based cache of recently processed subtrees:</p>
<ul>
<li>Each subtree hash is recorded when processing begins</li>
<li>Entries expire after <code>blockHeightRetention</code> period</li>
<li>Memory automatically cleaned up as entries age out</li>
</ul>
<p><strong>Concurrency Safety:</strong></p>
<p>The deduplicator is thread-safe for concurrent access:</p>
<ul>
<li>Multiple validation workers can query simultaneously</li>
<li>Lock-free reads for checking if subtree is being processed</li>
<li>Atomic operations for adding new subtree entries</li>
</ul>
<h5 id="integration-with-subtree-validation">Integration with Subtree Validation</h5>
<p>When the Block Validation service needs to validate a subtree:</p>
<ol>
<li><strong>Check Deduplicator</strong>: Query if subtree is already being processed</li>
<li><strong>If Already Processing</strong>: Skip validation, wait for result from first processor</li>
<li><strong>If New Subtree</strong>: Mark as processing in deduplicator, proceed with validation</li>
<li><strong>After Completion</strong>: Entry remains in cache with TTL to prevent duplicate work</li>
</ol>
<p>This coordination ensures:</p>
<ul>
<li>No redundant subtree validation computations</li>
<li>Reduced load on UTXO store and transaction validators</li>
<li>Lower memory and CPU usage during high block arrival rates</li>
</ul>
<p>For implementation details, see <code>deduplicator.go</code> in <code>services/blockvalidation/</code>.</p>
<h3 id="23-marking-txs-as-mined">2.3. Marking Txs as mined</h3>
<p>When a block is validated and added to the blockchain, the transactions within that block must be marked as mined in the UTXO store. This process is the second phase of the two-phase transaction commit system and is triggered through an event-driven notification mechanism.</p>
<h4 id="trigger-points-and-sequence">Trigger Points and Sequence</h4>
<p>The process to mark transactions as mined follows a two-step sequence with specific trigger points:</p>
<p><strong>Step 1: Setting Block Subtrees as Ready (<code>SetBlockSubtreesSet</code>)</strong></p>
<p>This step is triggered at different points depending on who mined the block:</p>
<ul>
<li><strong>Remotely Mined Blocks</strong>: <code>Block Validation</code> service triggers this AFTER successfully validating the block<ul>
<li>Trigger point: Immediately after <code>blockchainClient.AddBlock()</code> succeeds in <code>ValidateBlock()</code></li>
<li>This ensures the block is fully validated before marking subtrees as set</li>
</ul>
</li>
<li><strong>Locally Mined Blocks</strong>: <code>Block Assembly</code> service triggers this AFTER successfully assembling and mining a block<ul>
<li>Trigger point: Immediately after mining the block and adding it to the blockchain</li>
<li>Allows local transactions to be marked as mined without waiting for validation</li>
</ul>
</li>
</ul>
<p>When triggered, the service calls <code>blockchainClient.SetBlockSubtreesSet(blockHash)</code> which:</p>
<ol>
<li>Marks the block's subtrees as "set" in the blockchain store</li>
<li>Publishes <code>NotificationType_BlockSubtreesSet</code> event to all subscribers</li>
<li>Allows the system to proceed with marking transactions as mined</li>
</ol>
<p><img alt="blockchain_setblocksubtreesset.svg" src="../img/plantuml/blockchain/blockchain_setblocksubtreesset.svg" /></p>
<p><strong>Step 2: Marking Transactions as Mined (<code>SetMinedMulti</code>)</strong></p>
<p>This step is triggered automatically via event subscription:</p>
<ul>
<li><strong>Trigger</strong>: <code>NotificationType_BlockSubtreesSet</code> event from Blockchain service</li>
<li><strong>Subscriber</strong>: Block Validation service subscribes to blockchain notifications during initialization</li>
<li><strong>Handler</strong>: <code>OnBlockchainNotification()</code> receives the event and processes it</li>
</ul>
<p>When the event is received, Block Validation:</p>
<ol>
<li>Extracts all transaction hashes from the block's subtrees</li>
<li>Calls <code>utxoStore.SetMinedMulti(txHashes, blockInfo)</code> to batch-update all transactions</li>
<li>
<p>Each transaction is updated with:</p>
<ul>
<li><code>blockID</code>: The internal block identifier</li>
<li><code>blockHeight</code>: The block's height in the chain</li>
<li><code>subtreeIdx</code>: Index of the subtree containing the transaction</li>
<li><code>locked=false</code>: Completes the two-phase commit by unsetting the locked flag</li>
</ul>
</li>
</ol>
<p><img alt="block_validation_set_tx_mined.svg" src="../img/plantuml/blockvalidation/block_validation_set_tx_mined.svg" /></p>
<h4 id="integration-with-two-phase-commit">Integration with Two-Phase Commit</h4>
<p>The marking of transactions as mined serves as the <strong>second phase</strong> of the two-phase commit process:</p>
<p><strong>Phase 1 (Transaction Validation):</strong></p>
<ul>
<li>Validator service creates UTXOs with <code>locked=true</code></li>
<li>Transactions forwarded to Block Assembly for inclusion in blocks</li>
<li>Locked flag prevents double-spending before block confirmation</li>
</ul>
<p><strong>Phase 2 (Block Validation):</strong></p>
<ul>
<li>Block Validation marks transactions as mined</li>
<li><code>SetMinedMulti</code> automatically unsets <code>locked=false</code> for all transactions</li>
<li>Transactions now permanently associated with their mined block</li>
<li>UTXOs become fully spendable in subsequent transactions</li>
</ul>
<h4 id="responsibility-and-exclusivity">Responsibility and Exclusivity</h4>
<p>The Block Validation service has <strong>exclusive responsibility</strong> for marking transactions as mined, regardless of block source:</p>
<ul>
<li><strong>Remotely Mined Blocks</strong>: Block Validation validates and marks transactions as mined</li>
<li><strong>Locally Mined Blocks</strong>: Block Assembly triggers the event, but Block Validation still performs the actual marking</li>
<li><strong>Quick Validated Blocks</strong>: During catchup, quick validation calls <code>SetLocked(txHashes, false)</code> directly as a batch operation (see Section 2.2.3)</li>
</ul>
<p>This centralized responsibility ensures consistency in how transactions are marked across all scenarios.</p>
<h4 id="performance-optimization">Performance Optimization</h4>
<p>The <code>SetMinedMulti</code> operation is highly optimized for batch processing:</p>
<ul>
<li><strong>Batch Updates</strong>: All transactions in a block updated in single database operation</li>
<li><strong>Parallel Processing</strong>: For blocks with many subtrees, subtree processing can be parallelized</li>
<li><strong>Lua Script Execution</strong>: Aerospike UTXO store uses atomic Lua scripts for metadata updates</li>
<li><strong>Automatic Unlocking</strong>: Locked flag automatically unset as part of mined metadata update</li>
</ul>
<blockquote>
<p><strong>For a comprehensive explanation of the two-phase commit process across the entire system, including how Block Validation plays a role in the second phase, see the <a href="../../features/two_phase_commit/">Two-Phase Transaction Commit Process</a> documentation.</strong>
</p>
</blockquote>
<h2 id="3-grpc-protobuf-definitions">3. gRPC Protobuf Definitions</h2>
<p>The Block Validation Service uses gRPC for communication between nodes. The protobuf definitions used for defining the service methods and message formats can be seen in the <a href="../../../references/protobuf_docs/blockvalidationProto/">Block Validation protobuf documentation</a>.</p>
<h2 id="4-data-model">4. Data Model</h2>
<ul>
<li><a href="../../datamodel/block_data_model/">Block Data Model</a>: Contain lists of subtree identifiers.</li>
<li><a href="../../datamodel/subtree_data_model/">Subtree Data Model</a>: Contain lists of transaction IDs and their Merkle root.</li>
<li><a href="../../datamodel/transaction_data_model/">Transaction Data Model</a>: Comprehensive documentation covering both standard Bitcoin format and Extended Format (BIP-239), including automatic format conversion during block validation.</li>
<li><a href="../../datamodel/utxo_data_model/">UTXO Data Model</a>: UTXO and UTXO Metadata data models for managing unspent transaction outputs.</li>
</ul>
<h2 id="5-technology">5. Technology</h2>
<ol>
<li>
<p><strong>Go Programming Language (Golang)</strong>.</p>
</li>
<li>
<p><strong>gRPC (Google Remote Procedure Call)</strong>:</p>
<ul>
<li>Used for implementing server-client communication. gRPC is a high-performance, open-source framework that supports efficient communication between services.</li>
</ul>
</li>
<li>
<p><strong>Blockchain Data Stores</strong>:</p>
<ul>
<li>Integration with various stores such as UTXO (Unspent Transaction Output) store, blob store, and transaction metadata store.</li>
</ul>
</li>
<li>
<p><strong>Caching Mechanisms (ttlcache)</strong>:</p>
<ul>
<li>Uses <code>ttlcache</code>, a Go library for in-memory caching with time-to-live settings, to avoid redundant processing and improve performance.</li>
</ul>
</li>
<li>
<p><strong>Configuration Management (gocore)</strong>:</p>
<ul>
<li>Uses <code>gocore</code> for configuration management, allowing dynamic configuration of service parameters.</li>
</ul>
</li>
<li>
<p><strong>Networking and Protocol Buffers</strong>:</p>
<ul>
<li>Handles network communications and serializes structured data using Protocol Buffers, a language-neutral, platform-neutral, extensible mechanism for serializing structured data.</li>
</ul>
</li>
<li>
<p><strong>Synchronization Primitives (sync)</strong>:</p>
<ul>
<li>Utilizes Go's <code>sync</code> package for synchronization primitives like mutexes, aiding in managing concurrent access to shared resources.</li>
</ul>
</li>
</ol>
<h2 id="6-directory-structure-and-main-files">6. Directory Structure and Main Files</h2>
<div class="highlight"><pre><span></span><code>./services/blockvalidation

 BlockValidation.go                      - Core block validation logic and state management.
 BlockValidation_test.go                 - Unit tests for BlockValidation core logic.
 BlockValidation_difficulty_test.go      - Difficulty validation tests.
 BlockValidation_error_test.go           - Error handling tests for block validation.
 block_priority.go                       - Block priority queue management with retry logic.
 block_priority_test.go                  - Tests for priority queue functionality.
 block_priority_get_test.go              - Tests for priority queue retrieval operations.
 block_priority_coverage_test.go         - Coverage tests for priority queue.
 block_processing_retry_test.go          - Tests for block processing retry mechanisms.
 catchup.go                              - Main catchup orchestration with 11-step process.
 catchup_test.go                         - Comprehensive catchup tests.
 catchup_consolidated_test.go            - Consolidated catchup scenario tests.
 catchup_fork_handling_test.go           - Fork handling during catchup tests.
 catchup_get_block_headers.go            - Block header fetching for catchup.
 catchup_helpers_test.go                 - Helper functions for catchup tests.
 catchup_malicious_peer_test.go          - Malicious peer detection tests.
 catchup_network_resilience_test.go      - Network resilience during catchup tests.
 catchup_quickvalidation_test.go         - Quick validation during catchup tests.
 catchup_resource_exhaustion_test.go     - Resource exhaustion scenario tests.
 catchup_test_suite.go                   - Catchup test suite infrastructure.
 catchup.md                              - Catchup process documentation.
 catchup/                                - Catchup implementation package.
    (catchup helper functions)
 Client.go                               - Client-side API for block validation service.
 Client_test.go                          - Client tests.
 deduplicator.go                         - Subtree deduplication to prevent redundant processing.
 deduplicator_test.go                    - Deduplication tests.
 fork_manager.go                         - Fork tracking and chain reorganization management.
 fork_manager_test.go                    - Fork manager tests.
 fork_manager_atomic_counter_test.go     - Atomic counter tests for fork tracking.
 fork_manager_coverage_test.go           - Coverage tests for fork manager.
 fork_manager_metrics_test.go            - Fork manager metrics tests.
 get_blocks.go                           - Block retrieval and fetching logic.
 get_blocks_test.go                      - Block retrieval tests.
 integration_retry_test.go               - Integration tests for retry logic.
 Interface.go                            - Block validation service interface definition.
 InvalidBlocksKafkaProducer_test.go      - Tests for Kafka invalid block notifications.
 malicious_peer_handling_test.go         - Malicious peer tracking and banning tests.
 metrics.go                              - Prometheus metrics for monitoring.
 mock.go                                 - Mock implementations for testing.
 quick_validate.go                       - Optimized validation for checkpointed blocks.
 quick_validate_test.go                  - Quick validation tests.
 Server.go                               - Server-side implementation of block validation.
 Server_test.go                          - Server tests.
 blockvalidation_api/
    blockvalidation_api.pb.go           - Auto-generated protobuf Go bindings.
    blockvalidation_api.proto           - Protocol Buffers API definition.
    blockvalidation_api_grpc.pb.go      - gRPC-specific generated code.
 testdata/                               - Test fixtures and data.
 testhelpers/                            - Test helper utilities.
 ttl_queue.go                            - TTL queue for caching with time-based expiration.
 txmetacache.go                          - Transaction metadata cache for performance.
 txmetacache_test.go                     - Transaction metadata cache tests.
</code></pre></div>
<h2 id="7-how-to-run">7. How to run</h2>
<p>To run the Block Validation Service locally, you can execute the following command:</p>
<div class="highlight"><pre><span></span><code><span class="nv">SETTINGS_CONTEXT</span><span class="o">=</span>dev.<span class="o">[</span>YOUR_CONTEXT<span class="o">]</span><span class="w"> </span>go<span class="w"> </span>run<span class="w"> </span>.<span class="w"> </span>-blockvalidation<span class="o">=</span><span class="m">1</span>
</code></pre></div>
<p>Please refer to the <a href="../../../howto/locallyRunningServices/">Locally Running Services Documentation</a> document for more information on running the Block Validation Service locally.</p>
<h2 id="8-configuration-options-settings-flags">8. Configuration options (settings flags)</h2>
<p>For comprehensive configuration documentation including all settings, defaults, and interactions, see the <a href="../../../references/settings/services/blockvalidation_settings/">block Validation Settings Reference</a>.</p>
<h2 id="9-other-resources">9. Other Resources</h2>
<p><a href="../../../references/services/blockvalidation_reference/">Block Validation Reference</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  2025 BSV Blockchain Org.
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/bsv-blockchain/teranode" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.instant", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>